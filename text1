const { category, subcategory } = req.query;
console.log("Category:", category);
console.log("Subcategory:", subcategory);

let sql = `SELECT DISTINCT shop.* FROM shop`;

// Join with category table if category filter is provided
if (category) {
    sql += ` INNER JOIN category ON shop.category_id = category.category_id WHERE category.category_id IN (${category})`;
} else {
    sql += ` INNER JOIN category ON shop.category_id = category.category_id`;
}

// Join with subcategory table if subcategory filter is provided
if (subcategory) {
    // If category filter was applied, we use AND instead of WHERE
    if (category) {
        sql += ` AND`;
    } else {
        sql += ` WHERE`;
    }
    sql += ` shop.subcategory_id IN (${subcategory})`;
}


// console.log("Initial SQL:", sql);

try {
    const data = await queryDatabase(connection, sql);
    if (data.length > 0) {
        res.json({
            message: 'Success',
            data: data
        });
    } else {
        res.json({
            message: 'No data found',
            data: []
        });
    }
} catch (error) {
    console.error("Error executing SQL query:", error);
    res.status(500).json({ error: "Internal Server Error" });
}